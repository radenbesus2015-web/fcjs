(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,644075,e=>{"use strict";var t=e.i(846696);let s={success:"success",error:"error",warn:"warning",info:"info"},r={type:"info",title:"",message:"",delay:0,duration:3200,dismissible:!0,actionText:"",onAction:()=>{}};function a(e={}){let n={...r,..."string"==typeof e?{message:e}:e},i=s[n.type]||"info",l=()=>{var e;let s;return String((t.toast[i]||t.toast)(n.title||(e=n.type,(s="en"===function(){try{let e=localStorage.getItem("settings");if(!e)return"en";let t=JSON.parse(e),s=String(t?.language||"").toLowerCase();return"id"===s?"id":"en"}catch{return"en"}}()?{success:"Success",error:"Error",warn:"Warning",info:"Info"}:{success:"Berhasil",error:"Gagal",warn:"Perhatian",info:"Info"})[e]||s.info),{description:n.message||"",duration:n.duration,...n.actionText&&n.onAction?{action:{label:n.actionText,onClick:()=>n.onAction?.()}}:{},onDismiss:()=>{},onAutoClose:()=>{}}))};if(n.delay>0){let e=setTimeout(l,n.delay);return{id:null,cancel:()=>clearTimeout(e)}}return l()}e.s(["toast",0,{show:a,success:(e,t={})=>a({type:"success",message:e,...t||{}}),error:(e,t={})=>a({type:"error",message:e,...t||{}}),warn:(e,t={})=>a({type:"warn",message:e,...t||{}}),info:(e,t={})=>a({type:"info",message:e,...t||{}}),dismiss:e=>t.toast.dismiss(e)}])},394490,e=>{"use strict";var t=e.i(843476),s=e.i(271645),r=e.i(469701),a=e.i(567150),n=e.i(840463),i=e.i(644075),l=e.i(167881);function o(){let{t:e}=(0,r.useI18n)(),{useSetting:o}=(0,a.useSettings)(),c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(null),[m,f]=(0,s.useState)(!1),h=(0,s.useRef)(!1),[g,x]=(0,s.useState)(""),[p,b]=(0,s.useState)([]),[v,y]=(0,s.useState)(0),[j,w]=(0,s.useState)([]),[N,M]=(0,s.useState)([]),{model:S}=o("funMeter.sendWidth",{clamp:{min:160,max:1920,round:!0}}),{model:R}=o("funMeter.jpegQuality",{clamp:{min:0,max:1}}),{model:k}=o("funMeter.funIntervalMs",{clamp:{min:100,max:2e3,round:!0}}),E=(0,n.useWs)({url:"",root:!0,on:{connect(){x(e("funMeter.status.wsConnected","WS terhubung")),i.toast.success(e("funMeter.toast.wsConnected","Terhubung ke server WebSocket"))},disconnect(){x(e("funMeter.status.wsDisconnected","WS terputus")),i.toast.warn(e("funMeter.toast.wsDisconnected","Koneksi WebSocket terputus"))},fun_result(e){let t=Array.isArray(e?.results)?e.results:[];if(console.log("[FUN_RESULT] Received",t.length,"faces:",t),0===t.length){console.log("[FUN_RESULT] No faces detected"),b([]),y(0),M([]);return}b(t),y(t.length);let s=[],r=new Set;t.forEach((e,t)=>{console.log(`[FUN_RESULT] Face ${t+1}:`,{bbox:e.bbox,expr:e.expr,fun:e.fun,score:e.score,probs:e.probs}),e.probs&&(s.push({face:t+1,probs:e.probs}),Object.keys(e.probs).forEach(e=>r.add(e)))}),console.log("[FUN_RESULT] Emotion data:",s),M(s),w(Array.from(r).sort()),console.log("[FUN_RESULT] Drawing",t.length,"faces on canvas"),A(t)}}}),F=async()=>{if(c.current)try{let t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(!c.current)return;let s=c.current;s.srcObject=t,f(!0),x(e("funMeter.status.cameraActive","Kamera aktif")),await new Promise(e=>{s.readyState>=2?e(void 0):s.onloadedmetadata=()=>e(void 0)})}catch(t){x(e("funMeter.status.cameraDenied","Akses kamera ditolak")),i.toast.error(e("funMeter.toast.cameraError","Gagal mengakses kamera"))}},U=()=>{c.current?.srcObject&&(c.current.srcObject.getTracks().forEach(e=>e.stop()),c.current.srcObject=null),f(!1),x(e("funMeter.status.cameraStopped","Kamera dihentikan")),b([]),y(0),M([]);let t=d.current,s=t?.getContext("2d");t&&s&&s.clearRect(0,0,t.width,t.height)},A=s.default.useCallback(t=>{let s=e("funMeter.canvas.fun","Fun"),r=c.current,a=d.current,n=u.current;if(!r||!a||!n||!h.current)return void console.log("[DRAW_FUN] Missing refs:",{video:!!r,canvas:!!a,host:!!n});let i=n.getBoundingClientRect(),l=window.devicePixelRatio||1;a.width=Math.max(1,Math.round(i.width*l)),a.height=Math.max(1,Math.round(i.height*l)),a.style.width=`${i.width}px`,a.style.height=`${i.height}px`;let o=a.getContext("2d");if(!o)return;o.setTransform(l,0,0,l,0,0),o.clearRect(0,0,a.width,a.height);let m=r.videoWidth||640,f=r.videoHeight||480,g=i.width,x=i.height;console.log("[DRAW_FUN] Drawing",t.length,"faces. Canvas:",{cw:g,ch:x},"Video:",{vw:m,vh:f}),t.forEach((e,t)=>{let r,[a,n,i,l]=e.bbox||[0,0,0,0],c=a/m*g,d=n/f*x,u=i/m*g,h=l/f*x;console.log(`[DRAW_FUN] Face ${t+1} bbox:`,{bx:a,by:n,bw:i,bh:l},"→",{rx:c,ry:d,rw:u,rh:h}),o.strokeStyle="#38bdf8",o.lineWidth=3,o.strokeRect(c,d,u,h);let p=e.expr||"neutral",b=0;if(e.probs)for(let[t,s]of Object.entries(e.probs))s>b&&(b=s,p=t);let v=["happiness","happy","senang"].includes(r=String(p||"").toLowerCase().trim())?"Senang":["sadness","sad","sedih"].includes(r)?"Sedih":["surprise","surprised","kaget"].includes(r)?"Kaget":["anger","angry","marah"].includes(r)?"Marah":["fear","fearful","takut"].includes(r)?"Takut":["disgust","disgusted","jijik"].includes(r)?"Jijik":["neutral","biasa"].includes(r)?"Biasa":r?r.charAt(0).toUpperCase()+r.slice(1):"Biasa";if(v){o.font="bold 14px sans-serif";let e=o.measureText(v).width,s=d-8;o.fillStyle="rgba(56, 189, 248, 0.9)",o.fillRect(c,s-18,e+12,24),o.fillStyle="#fff",o.fillText(v,c+6,s-2),console.log(`[DRAW_FUN] Face ${t+1} dominant emotion:`,p,`(${(100*b).toFixed(1)}%)`)}let y=void 0!==e.fun?e.fun:e.score||0,j=`${s} ${Math.round(100*y)}%`;o.font="bold 12px sans-serif";let w=o.measureText(j).width,N=d+h+4;o.fillStyle="rgba(34, 197, 94, 0.9)",o.fillRect(c,N,w+8,20),o.fillStyle="#fff",o.fillText(j,c+4,N+14),console.log(`[DRAW_FUN] Face ${t+1} drawn:`,{expr:v,funScore:y})})},[e]),T=s.default.useCallback(async()=>{let e=c.current;if(!e||!E||e.readyState<2)return;let t=document.createElement("canvas"),s=Number(S)||640,r=e.videoWidth||640,a=Math.round((e.videoHeight||480)/r*s);t.width=s,t.height=a;let n=t.getContext("2d");if(n){n.drawImage(e,0,0,s,a);try{let e,s=(e=Number(R)||.8,Math.max(.1,Math.min(1,e))),r=await new Promise(e=>t.toBlob(e,"image/jpeg",s));if(!r)return void console.error("[PUSH_FUN_FRAME] Failed to create blob");let a=await r.arrayBuffer(),n=new Uint8Array(a);E.emit("fun_frame",n),console.log("[PUSH_FUN_FRAME] Sent binary frame to backend, size:",n.length,"bytes")}catch(e){console.error("[PUSH_FUN_FRAME] Error:",e)}}},[E,S,R]);return(0,s.useEffect)(()=>{if(!m||!E)return;let e=Number(k)||100;console.log(`[INTERVAL] Starting frame sending every ${e}ms`);let t=setInterval(()=>{T()},e);return()=>{console.log("[INTERVAL] Stopping frame sending"),clearInterval(t)}},[m,E,k,T]),(0,s.useEffect)(()=>{let e=()=>{console.log("[RESIZE] Window resized, redrawing",p.length,"faces"),h.current&&p.length>0&&A(p)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[p,A]),(0,s.useEffect)(()=>{h.current=m},[m]),(0,s.useEffect)(()=>(F(),()=>{U()}),[]),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-card rounded-lg border p-6",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-widest text-muted-foreground",children:e("funMeter.camera.title","Camera")}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:e("funMeter.camera.subtitle","Fun Meter Streaming")}),(0,t.jsxs)("div",{ref:u,className:"relative aspect-video rounded-lg border bg-muted/30 overflow-hidden mb-4",children:[(0,t.jsx)("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,t.jsx)("canvas",{ref:d,className:"absolute inset-0 w-full h-full pointer-events-none"}),v>0&&(0,t.jsx)("div",{className:"absolute top-2 right-2 bg-black/70 text-white px-3 py-1 rounded-full text-sm font-semibold",children:e("funMeter.camera.faces","Wajah: {count}",{count:v})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium block mb-1",children:e("funMeter.form.interval","Interval (ms)")}),(0,t.jsx)("input",{type:"number",value:k,onChange:e=>{e.target.value},className:"w-full px-3 py-2 border rounded-md",min:100,max:2e3,disabled:!0}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e("funMeter.form.changeViaSettings","Ubah melalui Pengaturan")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium block mb-1",children:e("funMeter.form.model","Model")}),(0,t.jsx)("div",{className:"h-10 flex items-center px-3 border rounded-md text-sm text-muted-foreground",children:e("funMeter.model.waiting","Waiting for metadata...")})]})]}),(0,t.jsx)("div",{className:"flex gap-2 mb-2",children:(0,t.jsx)(l.Button,{onClick:()=>{m?U():F()},children:m?e("funMeter.actions.stopCamera","Stop Camera"):e("funMeter.actions.startCamera","Start Camera")})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e("funMeter.camera.help","Press start to send fun meter frames.")})]}),(0,t.jsxs)("div",{className:"bg-card rounded-lg border p-6 self-start",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-widest text-muted-foreground",children:e("funMeter.summary.title","Summary")}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:e("funMeter.summary.subtitle","Labels & Last Results")})]}),(0,t.jsxs)("span",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold",children:[j.length," ",e("funMeter.summary.labels","labels")]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:e("funMeter.summary.description","Fun represents the probability of happiness (0–100%). The label list is fetched directly from the model on the server.")}),N.length>0&&(0,t.jsx)("div",{className:"space-y-4",children:N.map((s,r)=>(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm",children:e("funMeter.summary.faceLabel","WAJAH #{n}",{n:s.face})}),(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-semibold",children:["Fun ",Math.round(100*(s.probs.happy||s.probs.happiness||0)),"%"]})]}),(0,t.jsx)("div",{className:"space-y-2",children:Object.entries(s.probs).sort((e,t)=>t[1]-e[1]).map(([e,s])=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground capitalize",children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-primary",style:{width:`${100*s}%`}})}),(0,t.jsxs)("span",{className:"text-xs font-mono w-12 text-right",children:[(100*s).toFixed(1),"%"]})]})]},e))})]},r))}),0===N.length&&(0,t.jsx)("div",{className:"rounded-lg border border-dashed p-6 text-sm text-muted-foreground text-center",children:0===p.length?e("funMeter.summary.empty","No results from camera yet."):e("funMeter.summary.nonEmpty","Receiving results…")})]})]})})}e.s(["default",()=>o])}]);