(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,644075,e=>{"use strict";var t=e.i(846696);let a={success:"success",error:"error",warn:"warning",info:"info"},n={type:"info",title:"",message:"",delay:0,duration:3200,dismissible:!0,actionText:"",onAction:()=>{}};function r(e={}){let s={...n,..."string"==typeof e?{message:e}:e},l=a[s.type]||"info",i=()=>{var e;let a;return String((t.toast[l]||t.toast)(s.title||(e=s.type,(a="en"===function(){try{let e=localStorage.getItem("settings");if(!e)return"en";let t=JSON.parse(e),a=String(t?.language||"").toLowerCase();return"id"===a?"id":"en"}catch{return"en"}}()?{success:"Success",error:"Error",warn:"Warning",info:"Info"}:{success:"Berhasil",error:"Gagal",warn:"Perhatian",info:"Info"})[e]||a.info),{description:s.message||"",duration:s.duration,...s.actionText&&s.onAction?{action:{label:s.actionText,onClick:()=>s.onAction?.()}}:{},onDismiss:()=>{},onAutoClose:()=>{}}))};if(s.delay>0){let e=setTimeout(i,s.delay);return{id:null,cancel:()=>clearTimeout(e)}}return i()}e.s(["toast",0,{show:r,success:(e,t={})=>r({type:"success",message:e,...t||{}}),error:(e,t={})=>r({type:"error",message:e,...t||{}}),warn:(e,t={})=>r({type:"warn",message:e,...t||{}}),info:(e,t={})=>r({type:"info",message:e,...t||{}}),dismiss:e=>t.toast.dismiss(e)}])},154587,e=>{"use strict";var t=e.i(843476),a=e.i(271645),n=e.i(469701),r=e.i(567150),s=e.i(840463),l=e.i(644075),i=e.i(554858),c=e.i(167881),d=e.i(563906),d=d,o=e.i(251652),o=o,u=e.i(412012),u=u,m=e.i(246349),m=m,h=e.i(591513),h=h;let g=null,x=0,f=new WeakSet,p={video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!1};async function b(e=p){return g||(g=await navigator.mediaDevices.getUserMedia(e))}function w(){g&&(g.getTracks().forEach(e=>e.stop()),g=null)}async function j(e,t){let a=await b(t);return e.srcObject=a,f.has(e)||(f.add(e),x+=1),await new Promise(t=>{if(e.readyState>=2)return t();e.onloadedmetadata=()=>t()}),a}function v(){let{t:e}=(0,n.useI18n)(),{useSetting:p}=(0,r.useSettings)(),b=(0,a.useRef)(null),v=(0,a.useRef)(null),N=(0,a.useRef)(null),y=(0,a.useRef)(1),k=(0,a.useRef)(null),S=(0,a.useRef)(0),[C,T]=(0,a.useState)([]),[R,_]=(0,a.useState)(!1),[B,E]=(0,a.useState)(!1),[M,I]=(0,a.useState)([]),[$,A]=(0,a.useState)({page:1,total_pages:1,per_page:25,total:0,has_prev:!1,has_next:!1}),[P,z]=(0,a.useState)(10),[W,L]=(0,a.useState)("desc"),U=p("baseInterval",{clamp:{max:5e3,round:!0}}),{model:D}=p("attendance.sendWidth",{clamp:{min:160,max:1920,round:!0}}),{model:O}=p("attendance.jpegQuality",{clamp:{min:0,max:1}}),G=(0,s.useWs)({url:"",root:!0,on:{att_result(e){let t=Array.isArray(e?.results)?e.results:[];T(t),Q(t)}}}),J=async()=>{if(b.current)try{await j(b.current),E(!0),q()}catch{l.toast.error(e("attendance.toast.cameraError","Gagal mengakses kamera"))}},K=()=>{var e;(e=b.current)&&e.srcObject&&(e.srcObject=null),e&&f.has(e)&&(f.delete(e),x=Math.max(0,x-1)),0===x&&w(),E(!!g);let t=v.current,a=N.current;t&&a&&a.clearRect(0,0,t.width,t.height)},q=()=>{let e=v.current,t=b.current;if(!e||!t)return;let a=t.getBoundingClientRect(),n=window.devicePixelRatio||1;y.current=n,e.width=Math.round(a.width*n),e.height=Math.round(a.height*n),e.style.width=a.width+"px",e.style.height=a.height+"px";let r=N.current;r&&(r.setTransform(n,0,0,n,0,0),r.clearRect(0,0,e.width,e.height))},F=()=>{let e=b.current;if(!e)return!1;let t=e.videoWidth,a=e.videoHeight;return!!t&&!!a&&(S.current=Math.round(Number(D)*a/t),k.current||(k.current=document.createElement("canvas")),k.current.width=Number(D),k.current.height=S.current,!0)},H=async()=>{if(!k.current)return null;let e=k.current,t=document.createElement("canvas").toDataURL("image/webp").match("data:image/webp")?"image/webp":"image/jpeg",a=await new Promise(a=>e.toBlob(a,t,Number(O)));return a?new Uint8Array(await a.arrayBuffer()):null},Z=async()=>{if(G&&G.socket?.connected&&!R&&F()){_(!0);try{let e=k.current,t=b.current;if(!e||!t)return;let a=e.getContext("2d");if(!a)return;a.drawImage(t,0,0,e.width,e.height);let n=await H();n&&G&&G.emit("att_frame",n)}finally{_(!1)}}},Q=t=>{let a=v.current,n=N.current;if(!a||!n)return;n.clearRect(0,0,a.width,a.height);let r=b.current?.getBoundingClientRect();r&&t.forEach(t=>{let[a,s,l,i]=t.bbox||t.box||[0,0,0,0],c=b.current?.videoWidth||1,d=b.current?.videoHeight||1,o=a/c*r.width,u=s/d*r.height,m=l/c*r.width,h=i/d*r.height;n.strokeStyle="#38bdf8",n.lineWidth=3,n.strokeRect(o,u,m,h);let g=t.label||t.name||e("attendance.labels.unknown","Unknown");n.font="bold 12px sans-serif";let x=n.measureText(g).width;n.fillStyle="rgba(2,6,23,0.88)",n.fillRect(o,u-20,x+8,18),n.fillStyle="#e5e7eb",n.fillText(g,o+4,u-6)})};(0,a.useEffect)(()=>{if(!B)return;let e=setInterval(()=>{Z()},Number(U.model??500));return()=>clearInterval(e)},[B,U.model]);let V=a.default.useCallback(async(t=1)=>{try{let e=await (0,i.request)(`/attendance-log?page=${t}&per_page=${P}&order=${W}`);I(e.items||[]);let a=e.meta||$,n=Number(a.total??0),r=Math.max(1,Number(a.total_pages??(n>0?Math.ceil(n/P):1))),s=Math.max(1,Math.min(Number(a.page??t),r)),l={...a,page:s,per_page:P,total_pages:r,total:n,has_prev:s>1,has_next:s<r};A(l)}catch{l.toast.error(e("attendance.toast.fetchError","Gagal memuat data absensi"))}},[W,P,e]);return(0,a.useEffect)(()=>{V(1)},[V,P,W]),(0,a.useEffect)(()=>{let e=v.current;e&&(N.current=e.getContext("2d"),q());let t=()=>{F(),q(),C.length&&Q(C)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),K()}},[]),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[(0,t.jsxs)("div",{className:"bg-card rounded-lg border p-6 self-start",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-widest text-muted-foreground",children:e("attendance.sections.camera.title","Kamera")}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:e("attendance.sections.camera.subtitle","Streaming absensi")}),(0,t.jsxs)("div",{className:"relative rounded-lg border bg-muted/30 overflow-hidden mb-4",children:[(0,t.jsx)("video",{ref:b,autoPlay:!0,playsInline:!0,className:"w-full h-auto object-contain block"}),(0,t.jsx)("canvas",{ref:v,className:"absolute inset-0 w-full h-full pointer-events-none"})]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium block mb-1",children:e("attendance.fields.interval","Interval (ms)")}),(0,t.jsx)("input",{type:"number",value:U.model,onChange:e=>U.setModel(Number(e.target.value)),className:"w-full px-3 py-2 border rounded-md",min:"200",max:"5000"})]}),(0,t.jsx)("p",{className:"m-4 text-sm text-muted-foreground",children:e("attendance.status.waiting","Tekan mulai untuk mengirim frame ke server attendance.")}),(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(c.Button,{onClick:B?K:J,variant:B?"outline":"default",children:B?e("attendance.actions.stopCamera","Stop Camera"):e("attendance.actions.startCamera","Start Camera")})})]}),(0,t.jsxs)("div",{className:"bg-card rounded-lg border p-6 self-start",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-widest text-muted-foreground",children:e("attendance.sections.log.title","Log absensi")}),(0,t.jsx)("div",{className:"text-lg font-semibold",children:e("attendance.sections.log.subtitle","Riwayat kedatangan")})]}),(0,t.jsx)(c.Button,{onClick:()=>V(),size:"sm",variant:"outline",className:"aspect-square p-2",children:(0,t.jsx)(d.default,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e("attendance.fields.perPage","Jumlah per halaman")}),(0,t.jsx)("select",{value:P,onChange:e=>{z(Number(e.target.value)),V(1)},className:"h-9 w-full rounded-md border px-3 py-1 text-sm",children:[10,25,50].map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e("attendance.fields.order","Urutan")}),(0,t.jsxs)("select",{value:W,onChange:e=>{L(e.target.value),V(1)},className:"h-9 w-full rounded-md border px-3 py-1 text-sm",children:[(0,t.jsx)("option",{value:"desc",children:e("attendance.order.desc","Terbaru")}),(0,t.jsx)("option",{value:"asc",children:e("attendance.order.asc","Terlama")})]})]})]}),(0,t.jsx)("div",{className:"rounded-lg border p-0 text-sm overflow-x-auto",children:0===M.length?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:e("attendance.table.empty","Belum ada data absensi.")})}):(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-muted/40",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left p-3 font-medium w-16",children:e("attendance.table.no","No")}),(0,t.jsx)("th",{className:"text-left p-3 font-medium",children:e("attendance.table.name","Nama")}),(0,t.jsx)("th",{className:"text-left p-3 font-medium",children:e("attendance.table.dateTime","Waktu & tanggal")}),(0,t.jsx)("th",{className:"text-right p-3 font-medium w-24",children:e("attendance.table.score","Skor")})]})}),(0,t.jsx)("tbody",{children:M.map((e,a)=>{let n=($.page-1)*P+a+1;return(0,t.jsxs)("tr",{className:"border-b last:border-0",children:[(0,t.jsx)("td",{className:"p-3",children:n}),(0,t.jsx)("td",{className:"p-3",children:e.label||"-"}),(0,t.jsx)("td",{className:"p-3",children:function(e){try{let t=function(e){if(!e)return null;let t=String(e).trim().replace(" ","T");return/[zZ]|[+\-]\d{2}:\d{2}$/.test(t)||(t+="+07:00"),t}(e);if(!t)return"-";let a=new Date(t),n=new Intl.DateTimeFormat("id-ID",{timeZone:"Asia/Jakarta",weekday:"long",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(a),r=e=>n.find(t=>t.type===e)?.value||"";return`${r("hour")}.${r("minute")} - ${r("weekday")} ${r("day")}/${r("month")}/${r("year")}`}catch(t){return String(e)}}(e.ts)}),(0,t.jsx)("td",{className:"p-3 text-right font-mono",children:(e.score||0).toFixed(3)})]},`${e.ts}-${a}`)})})]})}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{children:[e("attendance.pagination.totalLabel","Total")," ",$.total||0]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>V(1),disabled:$.page<=1,children:(0,t.jsx)(o.default,{className:"h-4 w-4"})}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>V(Math.max(1,$.page-1)),disabled:$.page<=1,children:(0,t.jsx)(u.default,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"px-3 py-1 rounded-md bg-gray-100 text-foreground",children:$.page}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>V(Math.min($.total_pages,$.page+1)),disabled:$.page>=$.total_pages,children:(0,t.jsx)(m.default,{className:"h-4 w-4"})}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>V($.total_pages||1),disabled:$.page>=$.total_pages,children:(0,t.jsx)(h.default,{className:"h-4 w-4"})})]})]})]})]})})}window.addEventListener("pagehide",()=>{x=0,w()}),e.s(["default",()=>v],154587)}]);